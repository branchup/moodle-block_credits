{"version":3,"file":"modals.min.js","sources":["../src/modals.js"],"sourcesContent":["// This file is part of a 3rd party created module for Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * File.\n *\n * @module     block_credits/modals\n * @copyright  2023 Institut français du Japon\n * @author     Frédéric Massart <fred@branchup.tech>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport ModalForm from 'core_form/modalform';\nimport {get_string as getString} from 'core/str';\n\n/**\n * Delegate click.\n *\n * @param {String} regionSelector\n * @param {String} selector\n * @param {Function} callback\n */\nfunction delegateClick(regionSelector, selector, callback) {\n  document.querySelector(regionSelector).addEventListener('click', (e) => {\n    const target = e.target.closest(selector);\n    if (!target) {\n      return;\n    }\n    e.preventDefault();\n    callback(target);\n  });\n}\n\nexport const registerAddCreditButton = (selector) => {\n  document.querySelector(selector).addEventListener('click', (e) => {\n    e.preventDefault();\n    const userId = e.currentTarget.dataset.userid;\n    const pageCtxId = e.currentTarget.dataset.pagectxid;\n    openAddCreditModal(userId, pageCtxId);\n  });\n};\n\nexport const delegateExtendValidityButton = (regionSelector, selector) => {\n  delegateClick(regionSelector, selector, (target) => {\n    const creditId = target.dataset.creditid;\n    const pageCtxId = target.dataset.pagectxid;\n    openExtendValidityModal(creditId, pageCtxId);\n  });\n};\n\nexport const delegateExpireNowButton = (regionSelector, selector) => {\n  delegateClick(regionSelector, selector, (target) => {\n    const creditId = target.dataset.creditid;\n    const pageCtxId = target.dataset.pagectxid;\n    openExpireNowModal(creditId, pageCtxId);\n  });\n};\n\nconst openAddCreditModal = (userId, pageCtxId) => {\n  const modal = new ModalForm({\n    formClass: 'block_credits\\\\form\\\\credit_user_dynamic_form',\n    modalConfig: {scrollable: false, title: getString('addcredits', 'block_credits')},\n    args: {userid: userId, lockuser: userId > 0, pagectxid: pageCtxId},\n  });\n  modal.addEventListener(modal.events.FORM_SUBMITTED, function(e) {\n    if (e.detail.redirecturl) {\n      window.location.href = e.detail.redirecturl;\n    } else {\n      window.location.reload();\n    }\n  });\n  modal.show();\n};\n\nconst openExtendValidityModal = (creditId, pageCtxId) => {\n  const modal = new ModalForm({\n    formClass: 'block_credits\\\\form\\\\extend_validity_dynamic_form',\n    modalConfig: {scrollable: false, title: getString('extendvalidity', 'block_credits')},\n    args: {creditid: creditId, pagectxid: pageCtxId},\n  });\n  modal.addEventListener(modal.events.FORM_SUBMITTED, function(e) {\n    if (e.detail.redirecturl) {\n      window.location.href = e.detail.redirecturl;\n    } else {\n      window.location.reload();\n    }\n  });\n  modal.show();\n};\n\nconst openExpireNowModal = (creditId, pageCtxId) => {\n  const modal = new ModalForm({\n    formClass: 'block_credits\\\\form\\\\expire_now_dynamic_form',\n    modalConfig: {scrollable: false, title: getString('expirenow', 'block_credits')},\n    args: {creditid: creditId, pagectxid: pageCtxId},\n  });\n  modal.addEventListener(modal.events.FORM_SUBMITTED, function(e) {\n    if (e.detail.redirecturl) {\n      window.location.href = e.detail.redirecturl;\n    } else {\n      window.location.reload();\n    }\n  });\n  modal.show();\n};\n"],"names":["delegateClick","regionSelector","selector","callback","document","querySelector","addEventListener","e","target","closest","preventDefault","userId","currentTarget","dataset","userid","pageCtxId","pagectxid","openAddCreditModal","creditId","creditid","openExtendValidityModal","openExpireNowModal","modal","ModalForm","formClass","modalConfig","scrollable","title","args","lockuser","events","FORM_SUBMITTED","detail","redirecturl","window","location","href","reload","show"],"mappings":";;;;;;;;cAkCSA,cAAcC,eAAgBC,SAAUC,UAC/CC,SAASC,cAAcJ,gBAAgBK,iBAAiB,SAAUC,UAC1DC,OAASD,EAAEC,OAAOC,QAAQP,UAC3BM,SAGLD,EAAEG,iBACFP,SAASK,kRAI2BN,WACtCE,SAASC,cAAcH,UAAUI,iBAAiB,SAAUC,IAC1DA,EAAEG,uBACIC,OAASJ,EAAEK,cAAcC,QAAQC,OACjCC,UAAYR,EAAEK,cAAcC,QAAQG,UAC1CC,mBAAmBN,OAAQI,qDAIa,CAACd,eAAgBC,YAC3DF,cAAcC,eAAgBC,UAAWM,eACjCU,SAAWV,OAAOK,QAAQM,SAC1BJ,UAAYP,OAAOK,QAAQG,UACjCI,wBAAwBF,SAAUH,gDAIC,CAACd,eAAgBC,YACtDF,cAAcC,eAAgBC,UAAWM,eACjCU,SAAWV,OAAOK,QAAQM,SAC1BJ,UAAYP,OAAOK,QAAQG,UACjCK,mBAAmBH,SAAUH,qBAI3BE,mBAAqB,CAACN,OAAQI,mBAC5BO,MAAQ,IAAIC,mBAAU,CAC1BC,UAAW,gDACXC,YAAa,CAACC,YAAY,EAAOC,OAAO,mBAAU,aAAc,kBAChEC,KAAM,CAACd,OAAQH,OAAQkB,SAAUlB,OAAS,EAAGK,UAAWD,aAE1DO,MAAMhB,iBAAiBgB,MAAMQ,OAAOC,gBAAgB,SAASxB,GACvDA,EAAEyB,OAAOC,YACXC,OAAOC,SAASC,KAAO7B,EAAEyB,OAAOC,YAEhCC,OAAOC,SAASE,YAGpBf,MAAMgB,QAGFlB,wBAA0B,CAACF,SAAUH,mBACnCO,MAAQ,IAAIC,mBAAU,CAC1BC,UAAW,oDACXC,YAAa,CAACC,YAAY,EAAOC,OAAO,mBAAU,iBAAkB,kBACpEC,KAAM,CAACT,SAAUD,SAAUF,UAAWD,aAExCO,MAAMhB,iBAAiBgB,MAAMQ,OAAOC,gBAAgB,SAASxB,GACvDA,EAAEyB,OAAOC,YACXC,OAAOC,SAASC,KAAO7B,EAAEyB,OAAOC,YAEhCC,OAAOC,SAASE,YAGpBf,MAAMgB,QAGFjB,mBAAqB,CAACH,SAAUH,mBAC9BO,MAAQ,IAAIC,mBAAU,CAC1BC,UAAW,+CACXC,YAAa,CAACC,YAAY,EAAOC,OAAO,mBAAU,YAAa,kBAC/DC,KAAM,CAACT,SAAUD,SAAUF,UAAWD,aAExCO,MAAMhB,iBAAiBgB,MAAMQ,OAAOC,gBAAgB,SAASxB,GACvDA,EAAEyB,OAAOC,YACXC,OAAOC,SAASC,KAAO7B,EAAEyB,OAAOC,YAEhCC,OAAOC,SAASE,YAGpBf,MAAMgB"}